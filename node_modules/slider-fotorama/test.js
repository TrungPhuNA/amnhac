const fs = require('fs');
const pug = require('pug');

console.log('building tests...');


function readFiles(dirname, onFileContent, onError) {

	fs.readdir(dirname, (error, filenames) => {

		if (error) {
			onError(error);
			return;
		}

		filenames.forEach((filename) => {
			if (filename.indexOf('.') > -1) {
				fs.readFile(dirname + filename, 'utf-8', function(error, content) {
					if (error) {
						onError(error);
						return;
					}
					onFileContent(filename, content);
				});
			}
		});
	});
}


readFiles('./test/pug/', (filename, content) => {
	console.log('filename: ' + filename);
	if ('pug' !== filename.split('.').pop()) {
		return;
	}

	let html = pug.renderFile('./test/pug/' + filename);

	fs.writeFile('./test/' + filename.split('.').shift() + '.html', html, (error) => {
		if (error) {
			throw error;
		}
	});
	
}, (error) => {
	throw error;
});

console.log('done!');
